画像掲示板

このスクリプトはレッツPHP!<http://php.s3.to/>のgazou.phpを元に改造したものです。

futaba.php v0.8 lot.031015
最新版は双葉<http://www.2chan.net/script/>で配布しています。

moepic.php Ver 2.06 
最新版は萌え連<http://moepic.dip.jp/gazo/>で配布しています。

siokara.php Ver1.0.3 2004/05/22
最新版はとしあき@しおからスクリプト置場<http://siokara.que.jp/>で配布しています。

配布条件はレッツPHP!さん及び双葉さん及び萌え連さん及びしおからさんに準じます。
改造、再配布は自由にお願いいたします。

gif2png<http://www.tuxedo.org/~esr/gif2png/>がある場合は、
gifでもサムネイルを作れます。付属のバイナリはlinux-i386用です。

設置法：
１、設置するサーバーがPHP対応かどうかを調べる
２、そのサーバー内の設置したい場所にフォルダをつくりパーミッションを777(707)に設定する。
３、img.php の設定を編集する。＊PASSの変更は必ずしましょう。
４、同封されているファイルを必要な物だけサーバーに転送する(img.php gif2png moeta.gif etc...)。
５、設置場所内に必要なフォルダを作りパーミッションを777(707)に設定する。
６、img.php をブラウザから読み込むと自動的に必要なファイルが作成されます。


[構成例] ( ) 内は設定する必要があるパーミッション値
[public_html]┐
             ├[futaba]┐(777)or(707)             (スクリプト置き場所ディレクトリ)
             │        ├ img.php    (644)or(604) (メインスクリプト) cgiなら(755)
             │        ├ gif2png    (644)or(604) (変更の必要なし)
             ｜        ├ [src]      (777)or(707) (画像保存ディレクトリ)
             │        ├ [thumb]    (777)or(707) (サムネイル保存ディレクトリ)
             ｜        ├ [src_d]    (777)or(707) (殿堂画像保存ディレクトリ)
             ｜        ├ [moecount] (777)or(707) (萌えカウント保存ディレクトリ)
             ｜        ├ [res]      (777)or(707) (レスhtml格納ディレクトリ)
             │        └ [ref]      (777)or(707) (経由先html格納ディレクトリ)
             │
             └ index.html (トップページ)

サーバーにより多少設定が異なる場合があります。
必ず設置方法が記述されたページを探し、熟読するようにしてください。

********************************！注意！***************************************
・img.logのファイル名はデフォルトから変えてご使用ください。
　define(LOGFILE, 'img.log');             // ログファイル名
・設置サーバによってはindex.htmが無いと画像掲示板設置フォルダ内が見えてしまう場合があります。
　空のindex.htmを置くか、スクリプトの入り口ファイル名指定をindex.htmに変更してください。
　define('PHP_SELF2', 'img.htm');		// 入り口ファイル名
*******************************************************************************

-------------------------------------------------------------------------------
としあき＠しおから改スクリプト説明

[1] 「レス省略」を表示するレスの数
    レスしたときの表示数を入力します。'0'ですべて省略。'10'で10件レスを表示します。

[2] GIF表示にサムネイルを使用する
    サムネイルを使用しない場合、GIFをそのまま表示するため、アニメーションGIFが動きます。

[3] アニメーションGIFかどうかチェックする
    GIFが動くかどうかが、わかるようになります。精度不明…

[4] スレ主強制sage機能
    スレ主(新スレを立てる人)が、メール欄に'sage'と入力することで、そのスレが強制sage状態になります。

[5] 強制sageまでの時間
    時間を指定することによって強制sageが自動でONになります。

[6] 管理者強制sage処理
    管理人がsage指定することが可能になります。

[7] 強制sageを告知する
    管理者強制sage処理時に、そのスレの本文に言葉を追加します。変更したい場合は、545行目のところを弄るよろし。

[8] レス画像上限枚数
    スレ主の画像を除くそのスレ全ての画像の残りカウントです。超えるとそれ以上投稿できなくなります。

[9] レス画像残り告知する
    画像があと何枚貼れるかわかるように、そのスレの本文に言葉を追加します。変更したい場合は、551行目のところを弄るよろし。

[10] サムネ差し替えを告知する
    サムネイル差し替え時に、そのスレの本文に言葉を追加します。変更したい場合は、538,787行目のところを弄るよろし。

[11] ツール避けに画像リンクをhtml経由にする
    htmlに<META HTTP-EQUIV=\"refresh\" content=\"0;URL=･･･>で画像にリンクしています。

[12] レスをhtml経由にする
    PHPの読み出しが多く負荷が高い場合に有効です。普段使う分には特に必要ないでしょう。

[13] サムネイル差し替え機能の使用法
    あらかじめ使用したいサムネイル画像を準備してください。その際「普通用」「グロ用」
    「ロリ用」「三次用」などのように使い分けたい数分だけ準備してください。
    その準備した画像をimg.phpと同じディレクトリに配置します。

    準備した画像のファイル名と管理画面に表示させる項目名を決め、img.phpの
    R_THUM1～4、R_TITL1～4の定数を書き換えます。 R_THUM1～4 には差し替え画像の
    ファイル名を、R_TITL1～4 には管理画面で選択するための項目名を記入します。

    あとは、「管理画面」において「サムネイル差し替え」画面で差し替え操作を行います。
    「サムネイル差し替え画面」では上記で設定した項目名が表示されます。
     差し替えたい記事のチェックボックスと差し替え画面の種類をチェックして、
    「差し替え」ボタンのクリックすると差し替えが行われます。

    なお画像がGIFの場合で「GIFをサムネイル化するだけ」がチェックされている場合は、GIFサムネ化が優先されます。
    (つまり、差し替え画像のどれを選択しても関係なくGIFサムネに差し替えられます)

    この差し替え画像の数は増減が可能です。
    R_THUM1～4、R_TITL1～4の各定数の宣言の下にこのような行があります。
    $rep_thumb = array(R_TITL1=>R_THUM1,R_TITL2=>R_THUM2,R_TITL3=>R_THUM3,R_TITL4=>R_THUM4);
    この行の「R_TITL1=>R_THUM1」の部分を追加したり、削除することで差し替え画像の数を決められます。
    (ファイル名や項目名を定数にしていますが、実は上の行に直接文字列として設定することも出来ます)

[14] [ロGIFアニメ停止]チェックボックスについて
    投稿欄の[ロ画像なし]チェックボックスの横に[ロGIFアニメ停止]チェックボックスに
    チェックを入れて投稿することで最初からサムネイルで表示するようになります。

    この指定をしたスレは管理画面の「サムネイル差し替え」画面の状態枠に「スレ主」という文字が表示されます。
    「スレ主」表示がある場合、サムネイルの差し替えは可能ですが、サムネイル状態を解除することはできません。
    また、「スレ主」表示があるときに「GIFをサムネイル化するだけ」を指定しても、同じサムネに差し替えられる
    だけで意味がありません。(まぁ、差し替え告知の表示が出るくらいの違いはありますが)

    なお「GIF表示にサムネイルを使用する」をONにした場合、差し替え機能の「GIFをサムネイル化するだけ」が無効、
    [ロGIFアニメ停止]チェックボックスの機能が無効になります。(つまり、GIFはすべてサムネイル化されます)

[15] 殿堂ギャラリーに保管する画像の最大枚数
    規定枚数以上は、moepic.php Ver 2.07 と違い、削除していきます。

[16] 広告を挿入する
    もの凄く無駄な機能です。追加の仕方は、323行目のところの $adarray[0] を
    $adarray[1] $adarray[2] $adarray[3] ... とどんどん増やしていってください。
    減らすには逆の作業をすればOKです。

-------------------------------------------------------------------------------
萌え連改スクリプト説明

img.php のベースが、moepic.php Ver 2.06 のままなので、一応説明を書き足しておきます。

Ver 2.06 => Ver 2.07 への変更点
・殿堂画像が一定数から画像なし表示されるようにした（殿堂がいつまでも流れない問題対策として）
  同じようなシステムが付いているので問題ないと思っています。(未導入)

・萌えカウントIP規制を　１画像１カウントへ（殿堂荒らし対策）
  (1) に変更の方法を書きました。ですから、特に問題ありませんね。(未導入)

・萌えカウント管理画面で　全カウントIPログの確認ができるようになった
  (1) に変更の方法を書きました。ですから、特に問題ありませんね。(未導入)

・サムネイルの縮小をきれいにアンチエイリアスがかかるようにした
  関数 ImageCopyResampled の事です。(導入済み)

・URLリンクを規制できるようにした
  導入済みです。


(1) 萌えカウントシステムの変更場所の説明(荒らし対策)

    を書いてみたのですが、余りにも多い為、途中で挫折しました。
    配布する物に含めることにします（最初からそうやっておけば良かった・・・）
    imgM.php という名前で含めました。

-------------------------------------------------------------------------------
注意

1) キャッシュが効いてレスが反映されない場合があります。
   その際は
   <!-- meta HTTP-EQUIV="pragma" CONTENT="no-cache" -->
   を
   <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
   に変更してください。

2) ImageCopyResampled この関数はPHP 4.0.6で追加され、GD 2.0.1以降を必要とします。
   このスクリプトでは ImageCopyResized を上記のものに書き換えています。

3) BMP/FLASHの明示的な禁止はしていません。よりオリジナルに近いものにする為です。
   変更は 937行目
   switch ($size[2]) {
     case 1 : $ext=".gif";break;
     case 2 : $ext=".jpg";break;
     case 3 : $ext=".png";break;
     case 4 : $ext=".swf";break;
     case 5 : $ext=".psd";break;
     case 6 : $ext=".bmp";break;
     case 13 : $ext=".swf";break;
     default : $ext=".xxx";break;
   }
   を
   switch ($size[2]) {
     case 1 : $ext=".gif";break;
     case 2 : $ext=".jpg";break;
     case 3 : $ext=".png";break;
     default : $ext=".xxx";error("アップロードに失敗しました<br>GIF,JPG,PNG以外の画像ファイルは受け付けません",$dest);break;
   }
   に置き換えて使用してください。

4) カウンターはスタイルシートで定義しています。

-------------------------------------------------------------------------------

※お約束※
  このスクリプトに関しては、すべて自己責任でお願いします。
  バグっていてログが㌧でも泣かないこと。ｼｮｯﾊﾟｲ 所があるかもしれないのでご注意を。

※既知のバグ※
  ・.swf(FLASH)ファイルでヘッダがCWSだとupできない(PHP4.2.3以下)。
  ・殿堂入りの時、サムネイルが差し替えされていると、その画像比を元に差し替え前の画像がコピーされてしまう。

※最後に※
  このスクリプトは、萌え連さんが公開しているスクリプトにしおからさんの機能を追加したモノです。

  萌え連さんの 管理人さん 素晴らしいスクリプトを公開していただき、ありがとうございます。
  としあき＠しおからさんの ハゲあきさん、しおあきさん 許可していただき、ありがとうございます。

  Special Thanks! ハゲあきさん、いろいろとありがとうございます！


★独り言
 2004/06/12 からの主な修正点：
 futaba.php から名前を変更→img.php に。(futaba.php だと良からぬ勘違いがありそうだったので…)

 2004/06/22 からの主な修正点：
 いろいろです。img2(レスにも画像が貼れる) が同封されるようになりました。

 2004/07/14 からの主な修正点：
 img.php を削除。img2.php => img.php に変更。imgM.php 入りになる。

 2004/08/05 からの変更点：
 img.php を削除。img2.php => img.php に変更。旧img.php あっても使わないでしょ。
 img.php と img2.php は投票表示場所の違いだけです。img2 はレス,トップの両方表示されます。

 img2 カウントの表示位置汚いです…いいところがあったら教えてください。
 imgM は img を元に作成。だから、連続投票が禁止になっただけ。弄ったところは、萌えカウントシステムのみ。

 いろいろと修正＆整理整頓。。。バグっていたらすみません。。。許してね（オイ
 萌え連さんのシステムをみて、気分的にhtml等を修正したくなったので修正しました。

 img3を入れてみました。前のファイルに上書きしてもレスに画像が貼れます。

 moepic V.2.07 では、殿堂入りの画像は消されませんが、このスクリプトでは消しますよん。
 残念ながら(?)、このスクリプトのベースは、moepic V.2.06 のままです。特に変更するところがなかったから。
 無駄な機能が増えました。萌えカウントを表示するかどうか、広告を表示するかどうかが選べます。
 厨房大量発生時は、萌えカウントシステムを変更しておいた方がいいかも。(1)を参照してね。

 ここでの説明は、すべて img.php に基づいています。

 Readme.txt 相変わらず汚いなぁ… 

2004/08/08
